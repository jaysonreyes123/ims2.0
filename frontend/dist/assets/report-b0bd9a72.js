import{S as i,U as l}from"./index-d9888335.js";import{u as d}from"./dropdown-387ba376.js";i();d();const p=l("report",{state:()=>({module:"",loading:!1,fields_list:[],module_list:[],columns:[],generate_report_list:[],relation_module:[],data:[],form:{modules:"",type:"",group_by:"",data_field:"",report_name:"",selected_column:[],related_module:[],chart:{type:"",dataset:[],group_by:""},filter:[{field:"",operator:"",type:"text",value:""}]}}),actions:{async report_list(){this.loading=!0;const t=(await this.axios.get("reports/"+this.id,{params:{limit:100}})).data.data;this.generate_report_list=t,this.loading=!1},async get_chart(e){this.loading=!0,await this.axios.get("reports/get_chart/"+e),this.loading=!1},async get_fields(){try{this.loading=!0,this.fields_list=[],this.form.selected_column=[];const t=(await this.axios.post("reports/get_fields",{module:this.form.modules,related_module:this.form.related_module})).data.data;Object.keys(t).map(a=>{this.fields_list.push({label:a,header:!0}),t[a].map(r=>{const o=r.table+"."+r.name;this.fields_list.push({label:r.label,value:o,type:r.type,header:!1})})}),this.loading=!1}catch{}},async get_relation_module(){try{this.loading=!0,this.fields_list=[],this.form.related_module=[],this.relation_module=[],(await this.axios.get("get_related_menu/"+this.module)).data.data.map(t=>{this.relation_module.push({value:t.related_menus.name,label:t.label})}),this.loading=!1}catch{}},async get_single_data(){try{this.loading=!0;const t=(await this.axios.get("reports/"+this.id+"/edit")).data.data;this.form.report_name=t.report_name,this.form.type=t.type,this.form.group_by=t.group_by,this.form.data_field=t.data_field,this.form.pin=t.pin,this.form.modules=t.modules,this.data=t,this.loading=!1}catch{}},async get(){try{this.get_relation_module(),this.form.selected_column=[],this.form.filter=[],this.loading=!0;const t=(await this.axios.get("reports/"+this.id+"/edit")).data.data;this.form.modules=t.modules,this.form.report_name=t.report_name,this.form.related_module=JSON.parse(t.related_module),t.type=="list"?t.report_conditions.map((s,a)=>{let r={},o=s.value;s.type=="picklist"&&(this.load_picklist(s.column),o=parseInt(s.value)),r.field=s.column,r.operator=s.operator,r.value=o,r.type=s.type,this.form.filter.push(r)}):(this.form.chart.type=t.report_charts.chart,this.form.chart.dataset=JSON.parse(t.report_charts.dataset),this.form.chart.group_by=t.report_charts.groupby),this.loading=!1}catch{}},async get_report_column(){this.columns=[],this.loading=!0,(await this.axios.get("reports/get_columns/"+this.id)).data.data.report_columns.map(s=>{const a={};a.label=s.label,a.field=s.column.replace(".","_"),this.columns.push(a)}),this.report_list()},async save(){try{this.loading=!0;let e;this.id==""?(e=await this.axios.post("reports",this.form),this.id=e.data.data.id):e=await this.axios.put("reports/"+this.id,this.form),this.loading=!1,this.router.push({name:"generate",params:{id:this.id,module:"reports"}})}catch{}},async report_export(e){try{this.loading=!0;const t=await this.axios.get("reports/generate/export/"+e+"/"+this.id,{responseType:"blob"}),s=URL.createObjectURL(t.data),a=document.createElement("a");a.href=s,a.setAttribute("download",this.form.report_name+"."+e),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),this.loading=!1}catch{}}},persist:!0});export{p as u};
