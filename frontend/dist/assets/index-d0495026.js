import{B as I}from"./index-a82eb94e.js";import{S as O}from"./Table-f62e2cbb.js";import{i as D}from"./incident_map-1fc65e61.js";import{C as N}from"./index-de911cd9.js";import{S as V,U as F,_ as M,r as B,c as r,f as o,F as C,D as S,C as _,w as h,d as u,a as g,b as s,t as l,h as p,g as P}from"./index-703ff788.js";import"./index-96abb035.js";import"./mapbox-gl-6cf0b8b4.js";import"./index-3fa781ec.js";V();const z=F("dashboard",{state:()=>({loading:!1,widgets:[],chart:[],logs:[],logs_page:{current:1,total:0,last:!1}}),getters:{},actions:{async system_logs(){try{this.loading=!0;const e=await this.axios.get("dashboard/systemlogs?page="+this.logs_page.current);this.logs.push(...e.data.data),this.logs_page.current=e.data.meta.current_page,e.data.meta.current_page==e.data.meta.last_page&&(this.logs_page.last=!0),this.loading=!1}catch{}},async get_dashboard_report_chart(){try{this.loading=!0;const e=await this.axios.get("dashboard/get_report_charts");this.chart=e.data.data,this.loading=!1}catch{}},async get_widget(e,a,f,x=null,n=null,d=null){try{this.widgets[f]={loading:!0};let c="";x==null&&n==null&&d==null?c="dashboard/widget/"+e:c="dashboard/widget/"+e+"/"+x+"/"+n+"/"+d;const m=await this.axios.get(c);this.widgets[f]={title:a,count:m.data.data},this.widgets[f].loading=!1,console.log(this.widgets)}catch{}}},persist:!0}),k=B(!1),v=B(!1),i=z(),A={components:{Card:N,Button:I,incident_map:D,SkeletonTable:O},mounted(){i.widgets=[],i.logs=[],i.logs_page.last=!1,i.logs_page.current=1,i.get_widget("incidents","Total Incident",0),i.get_widget("incidents","Active Incidents",1,"incident_statuses","<>","Closed:Cancelled"),i.get_widget("incidents","Closed Incidents",2,"incident_statuses","=","Closed"),i.system_logs(),this.incident_trend_month(),this.incident_status()},methods:{loadMore_SystemLogs(){i.logs_page.current++,i.system_logs()},async incident_trend_month(){k.value=!0;const a=(await this.$axios.get("dashboard/chart/incident_trend_month")).data.data;setTimeout(()=>{this.$refs.chart_vertical!=null&&this.$refs.chart_vertical.updateOptions({series:[{data:a.count}],xaxis:{categories:a.label}})},1e3),k.value=!1},async incident_status(){try{v.value=!0;const a=(await this.$axios.get("dashboard/chart/incident_status")).data.data;setTimeout(()=>{this.$refs.chart_pie!=null&&this.$refs.chart_pie.updateOptions({series:a.count,labels:a.label})},1e3),v.value=!1}catch{}}},computed:{BarChartConfiguration(){return{loading:!1,series:[{data:[]}],chartOptions:{chart:{toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,offsetX:-6,style:{fontSize:"14px",colors:["#fff"]}},xaxis:{categories:[]},colors:["#4669FA"]}}},PieChartConfiguration(){return{series:[],chartOptions:{labels:[],dataLabels:{formatter:function(e,a){return a.w.config.series[a.seriesIndex]},enabled:!0},responsive:[{breakpoint:480,options:{legend:{position:"bottom"}}}]}}}},data(){return{dashboard_store:i,barchart_loading:k,piechart_loading:v}}},j={class:"grid md:grid-cols-6 sm:grid-cols-2 grid-cols-1 gap-3"},E={key:1,class:"rounded-md p-4 shadow-md text-center bg-white"},H={class:"block text-sm text-slate-600 font-medium dark:text-white mb-1"},U={class:"block mb- text-2xl text-slate-900 dark:text-white font-medium"},X={class:"flex gap-x-4 mt-4"},q={class:"w-3/4"},G={class:"grid grid-cols-2 gap-x-4"},J={class:"grid mt-4"},K={class:"w-1/4"},Q={class:"relative ltr:pl-2 rtl:pr-2 overflow-y-auto max-h-[700px] h-[700px]"},R={class:"text-xs"},W={key:0},Y={key:1},Z={key:1},$={class:"text-xs"},tt={class:"mt-4"};function et(e,a,f,x,n,d){const c=g("SkeletonTable"),m=g("apexchart"),b=g("Card"),L=g("incident_map"),y=g("router-link"),T=g("Button");return s(),r("div",null,[o("div",j,[(s(!0),r(C,null,S(n.dashboard_store.widgets,(t,w)=>(s(),r("div",{key:w},[t.loading?(s(),_(c,{key:0,count:0})):(s(),r("div",E,[o("span",H,l(t.title),1),o("span",U,l(t.count),1)]))]))),128))]),o("div",X,[o("div",q,[o("div",G,[n.barchart_loading?(s(),_(c,{key:0})):(s(),_(b,{key:1,title:"# of Incidents, Trend over the 6 months"},{default:h(()=>[u(m,{ref:"chart_vertical",type:"bar",height:"200px",options:d.BarChartConfiguration.chartOptions,series:d.BarChartConfiguration.series},null,8,["options","series"])]),_:1})),n.piechart_loading?(s(),_(c,{key:2})):(s(),_(b,{key:3,title:"Incident Status"},{default:h(()=>[u(m,{ref:"chart_pie",type:"pie",height:"200px",options:d.PieChartConfiguration.chartOptions,series:d.PieChartConfiguration.series},null,8,["options","series"])]),_:1}))]),o("div",J,[u(b,{title:"Incident Map"},{default:h(()=>[u(L,{legend:!1,classHeight:"h-[500px]"})]),_:1})])]),o("div",K,[u(b,{title:"System logs"},{default:h(()=>[o("ul",Q,[(s(!0),r(C,null,S(n.dashboard_store.logs,(t,w)=>(s(),r("li",{key:w,class:"mt-5 flex justify-between items-center"},[o("div",R,[o("b",null,l(t.whodid),1),p(" "+l(t.status)+" ",1),t.status=="Linked"?(s(),r("span",W,[u(y,{class:"hover:text-blue-500 font-bold",to:{name:"related_list",params:{module:t.module,related_module:t.related_module,id:t.itemid}}},{default:h(()=>[p(l(t.related_field),1)]),_:2},1032,["to"]),a[0]||(a[0]=p(" for ")),u(y,{class:"hover:text-blue-500",to:{name:"view",params:{action:"detail",id:t.itemid,module:t.module}}},{default:h(()=>[p(l(t.field),1)]),_:2},1032,["to"])])):(s(),r("span",Y,[t.status!="Deleted"?(s(),_(y,{key:0,class:"hover:text-blue-500",to:{name:"view",params:{module:t.module,id:t.itemid,action:"detail"}}},{default:h(()=>[p(l(t.field),1)]),_:2},1032,["to"])):(s(),r("span",Z,l(t.field),1))]))]),o("div",$,l(t.timestamp),1)]))),128))]),o("div",tt,[n.dashboard_store.logs_page.last?P("",!0):(s(),_(T,{key:0,onClick:d.loadMore_SystemLogs,text:"Load more...",btnClass:"btn-outline-dark btn-sm w-full",isLoading:n.dashboard_store.loading},null,8,["onClick","isLoading"]))])]),_:1})])])])}const ct=M(A,[["render",et]]);export{ct as default};
