import{S as n,U as d}from"./index-703ff788.js";import{u as l}from"./dropdown-c7aa31e0.js";import{S as r}from"./sweetalert2.all-43cb5b43.js";import{u as h}from"./list-108db02a.js";const m=h(),f=l();n();const p=d("module",{state:()=>({loading:!1,module:"",entityname_field:"",entityname:"",id:"",data:[],required_field:{},form:{},summary:0,blocks:[],relation_field:{},error:!1}),actions:{clear(){this.form={},this.data=[],this.required_field={}},async generate(s){try{this.loading=!0;const t=await this.axios.get("module/generate/"+this.module);this.form[s]=t.data,this.loading=!1}catch{}},set_form(s){this.required_field=[],this.form=Object.assign(this.form,{module:this.module,id:"",created_at:"",updated_at:"",created_by:"",updated_by:""}),s.map(t=>{t.fields.map(e=>{const i={};if(i[e.name]=e.default_value==null?"":e.default_value,this.form=Object.assign(this.form,i),e.type=="dropdown")f.get_dropdown(e.name);else if(e.type=="generate")(this.id==""||this.id===void 0)&&this.generate(e.name);else if(e.type=="relation"){const a={};a[e.name]="",this.relation_field=Object.assign(this.relation_field,a),this.set_single_item(e.id,e.name)}if(e.required==1){const a={};a[e.name]=e.label,this.get_required_field(a)}})})},get_required_field(s){this.required_field=Object.assign(this.required_field,s)},view_set_form(s){this.required_field=[],this.form=Object.assign(this.form,{module:this.module,id:"",created_at:"",updated_at:"",created_by:"",updated_by:""}),s.map(t=>{t.fields.map(e=>{const i={};if(i[e.name]=e.default_value==null?"":e.default_value,this.form=Object.assign(this.form,i),e.type=="relation"){const a={};a[e.name]="",this.relation_field=Object.assign(this.relation_field,a),this.set_single_item(e.id,e.name)}})})},async get_edit_form(s,t="save"){try{this.clear(),this.loading=!0;const e=await this.axios.get("module/edit/form/"+this.module+"/"+t),i=e.data.data;this.blocks=i.blocks,this.id=s,this.data=e.data.data,this.entityname_field=e.data.data.entityname,t=="save"?this.set_form(i.blocks):(t=="detail"||t=="summary")&&this.view_set_form(i.blocks),s!=""&&s!==void 0?this.get(s):this.loading=!1}catch{}},async get(s){try{this.loading=!0;let t;t=await this.axios.get("module/"+s,{params:{module:this.module}});const e=t.data.data;Object.keys(this.form).map(a=>{a!="module"&&(this.form[a]=e[a])}),this.entityname_func(),this.loading=!1}catch{}},entityname_func(){this.entityname="",this.entityname_field.split(",").map(t=>{const e=this.form[t]==null?"":this.form[t];this.entityname+=e+" "})},async get_summary(){try{this.summary=0;const s=await this.axios.get("module/get_summary/"+this.module);this.summary=s.data.data}catch{}},async save(){try{if(this.loading=!0,this.form.id==""){const t=await this.axios.post("module",this.form);this.form.id=t.data.data}else{const t=await this.axios.put("module/"+this.form.id,this.form)}this.router.push({name:"view",params:{id:this.form.id,module:this.form.module,action:"detail"}}),this.loading=!1}catch(t){const e=t.response;if(e.status==422){const i=Object.values(e.data.errors);var s="";i.map((a,o)=>{s+=`<p class="text-red-500">${a[0]}</p>`}),r.fire({icon:"error",title:"Something wrong",html:s})}else e.status==500&&r.fire({icon:"error",title:"Something wrong",html:e.data.message});this.loading=!1}},async save_profile(){try{if(this.loading=!0,this.id==""){const t=await this.axios.post("module",this.form)}else await this.axios.put("module/"+this.form.id,this.form);this.router.push({name:"profile"}),this.loading=!1}catch(t){const e=t.response;if(e.status==422){const i=Object.values(e.data.errors);var s="";i.map((a,o)=>{s=`<p class="text-red-500">${a[o]}</p>`}),r.fire({icon:"error",title:"Something wrong",html:s})}else e.status==500&&r.fire({icon:"error",title:"Something wrong",html:e.data.message});console.log(e),this.loading=!1}},async get_single_item(s,t,e){try{this.loading=!0;const a=(await this.axios.get("module/get_single_item/"+s+"/"+t)).data.data;this.relation_field[e]=a.entityname,this.form[e]=t,this.loading=!1,m.modal=!1}catch{}},async set_single_item(s,t){try{const i=(await this.axios.get("module/set_single_item/"+this.id+"/"+s+"/"+t)).data.data;this.relation_field[t]=i.entityname}catch{}}},persist:!0});export{p as u};
