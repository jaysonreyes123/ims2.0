import{S as o,U as d}from"./index-aae2f258.js";import{u as l}from"./dropdown-689d2ad1.js";const n=l();o();const c=d("related",{state:()=>({modal:!1,loading:!1,id:"",module:"",related_module:"",related_menu:[],columns:[],columns_header:[],filter_data:[],list_data:[],search:"",page:{total:0,current:1,per_page:0},data:[],required_field:{},form:{}}),getters:{},actions:{async get_related_menu(e){try{const a=await this.axios.get("get_related_menu/"+e);this.related_menu=a.data.data}catch{}},async get_column(e,a,t){try{this.loading=!0;const s=(await this.axios.get("list/columns",{params:{module:t}})).data;this.columns_header=s.data,s.data.map(i=>{this.columns.push(i.name)}),this.columns_header.push({field:"action",label:"Action"}),this.columns.push("id"),this.loading=!1,this.get_related_list(e,a,t)}catch{}},async get_related_list(e,a,t){try{this.loading=!0;const s=(await this.axios.get("get_related_list/"+e+"/"+a+"/"+t+"?page="+this.page.current)).data.data;this.list_data=s.data,this.page.total=s.total,this.page.per_page=s.per_page,this.loading=!1}catch{}},claer(){this.form={},this.data=[],this.required_field={}},async generate(e){try{this.loading=!0;const a=await this.axios.get("module/generate/"+this.related_module);this.form[e]=a.data,this.loading=!1}catch{}},set_form(e){this.required_field=[],this.form=Object.assign(this.form,{module:this.module,id:"",related_id:"",created_at:"",updated_at:"",created_by:"",updated_by:""}),e.map(a=>{a.fields.map(t=>{const r={};if(r[t.name]=t.default_value==null?"":t.default_value,this.form=Object.assign(this.form,r),t.type=="dropdown"?n.get_dropdown(t.name):t.type=="generate"&&(this.id==""||this.id===void 0)&&this.generate(t.name),t.required==1){const s={};s[t.name]=t.label,this.get_required_field(s)}})})},get_required_field(e){this.required_field=Object.assign(this.required_field,e)},async get_edit_form(){try{this.loading=!0;const e=await this.axios.get("module/edit/form/"+this.related_module),a=e.data.data;this.set_form(a.blocks),this.data=e.data.data,this.loading=!1}catch{}},async get(e,a){try{this.loading=!0;const r=(await this.axios.get("module/"+a,{params:{module:this.related_module}})).data.data;Object.keys(this.form).map(i=>{i!="module"&&i!="id"&&(this.form[i]=r[i])}),this.form.id=parseInt(e),this.form.related_id=a,this.loading=!1}catch{}},async save(){try{this.loading=!0,this.form.related_module=this.related_module,this.form.module=this.module;const e=await this.axios.post("save_relation",this.form);this.loading=!1,this.get_column(this.form.id,this.form.module,this.form.related_module),this.modal=!1}catch{}},async delete(e,a,t,r,s){try{this.loading=!0,(await this.axios.get("related/delete/"+e+"/"+a+"/"+t+"/"+r)).data.data==1&&this.list_data.splice(s,1),this.loading=!1}catch{}}},persist:!0});export{c as u};
