import{S as _,U as u}from"./index-703ff788.js";import{u as m}from"./dropdown-c7aa31e0.js";import{u as f}from"./module-ee2e983e.js";f();const g=m();_();const b=u("related",{state:()=>({select_list_modal:!1,modal:!1,loading:!1,id:"",module:"",related_module:"",method:"",related_menu:[],columns:[],columns_header:[],filter_data:[],list_data:[],list_data_remove_relation:[],search:"",page:{total:0,current:1,per_page:0},data:[],required_field:{},form:{},blocks:[]}),getters:{},actions:{async get_related_menu(e){try{const a=await this.axios.get("get_related_menu/"+e);this.related_menu=a.data.data}catch{}},async get_column(e,a,t){const s=JSON.parse(localStorage.getItem("related_column_header"));if(s==null?!1:s.hasOwnProperty(t))s[t].map(o=>{this.columns.push(o.name)}),this.columns.push("id"),this.columns_header=s[t],this.get_related_list(e,a,t);else try{this.loading=!0;const d=(await this.axios.get("list/columns",{params:{module:t}})).data;this.columns_header=d.data,this.columns_header.push({field:"action",label:"Action"});var r=d.data.map(c=>c.name),n=[...r,"id"];this.columns=n;const l={};l[t]=this.columns_header;const h={...s,...l};localStorage.setItem("related_column_header",JSON.stringify(h)),this.get_related_list(e,a,t)}catch{}},async get_related_list(e,a,t,s=0){try{this.loading=!0;const r=(await this.axios.get("get_related_list/"+e+"/"+a+"/"+t+"?page="+this.page.current,{params:{search:this.search,option:s}})).data.data;s==1?this.list_data_remove_relation=r.data:this.list_data=r.data,this.page.total=r.total,this.page.per_page=r.per_page,this.loading=!1}catch{}},claer(){this.form={},this.data=[],this.required_field={}},async generate(e){try{this.loading=!0;const a=await this.axios.get("module/generate/"+this.related_module);this.form[e]=a.data,this.loading=!1}catch{}},set_form(e){this.required_field=[],this.form=Object.assign(this.form,{module:this.module,id:"",related_id:"",created_at:"",updated_at:"",created_by:"",updated_by:""}),e.map(a=>{a.fields.map(t=>{const s={};if(s[t.name]=t.default_value==null?"":t.default_value,this.form=Object.assign(this.form,s),t.type=="dropdown"?g.get_dropdown(t.name):t.type=="generate"&&(this.id==""||this.id===void 0)&&this.generate(t.name),t.required==1){const i={};i[t.name]=t.label,this.get_required_field(i)}})})},get_required_field(e){this.required_field=Object.assign(this.required_field,e)},async get_edit_form(e,a){try{this.loading=!0;const t=await this.axios.get("module/edit/form/"+this.related_module+"/detail"),s=t.data.data;this.id=e,this.set_form(s.blocks),this.data=t.data.data,a!=""?this.get(e,a):this.loading=!1}catch{}},async get(e,a){try{this.loading=!0;const s=(await this.axios.get("module/"+a,{params:{module:this.related_module}})).data.data;Object.keys(this.form).map(r=>{r!="module"&&r!="id"&&(this.form[r]=s[r])}),this.form.id=parseInt(e),this.form.related_id=a,this.loading=!1}catch{}},async save(){try{this.loading=!0,this.form.related_module=this.related_module,this.form.module=this.module;const e=await this.axios.post("save_relation",this.form);this.loading=!1,this.get_column(this.form.id,this.form.module,this.form.related_module),this.modal=!1}catch{}},async delete(e,a,t,s,i){try{this.loading=!0,(await this.axios.get("related/delete/"+e+"/"+a+"/"+t+"/"+s)).data.data==1&&this.list_data.splice(i,1),this.loading=!1}catch{}},async save_selected_row(e){try{this.loading=!0;const a=await this.axios.post("related/save_selected_row",e);this.get_related_list(e.id,e.module,e.related_module),this.select_list_modal=!1}catch{}},async get_related_block(){try{this.loading=!0;const e=await this.axios.get("related/get_related_blocks/"+this.module+"/"+this.related_module);this.blocks=e.data.data,this.loading=!1}catch{}}},persist:!0});export{b as u};
