import{S as o,U as d}from"./index-919f49e3.js";import{u as l}from"./dropdown-c096971e.js";const n=l();o();const c=d("related",{state:()=>({modal:!1,loading:!1,id:"",module:"",related_module:"",related_menu:[],columns:[],columns_header:[],filter_data:[],list_data:[],search:"",page:{total:0,current:1,per_page:0},data:[],required_field:{},form:{}}),getters:{},actions:{async get_related_menu(t){try{const a=await this.axios.get("get_related_menu/"+t);this.related_menu=a.data.data}catch{}},async get_column(t,a,e){try{this.loading=!0;const r=(await this.axios.get("list/columns",{params:{module:e}})).data;this.columns_header=r.data,r.data.map(i=>{this.columns.push(i.name)}),this.columns_header.push({field:"action",label:"Action"}),this.columns.push("id"),this.loading=!1,this.get_related_list(t,a,e)}catch{}},async get_related_list(t,a,e){try{this.loading=!0;const r=(await this.axios.get("get_related_list/"+t+"/"+a+"/"+e+"?page="+this.page.current)).data.data;this.list_data=r.data,this.page.total=r.total,this.page.per_page=r.per_page,this.loading=!1}catch{}},claer(){this.form={},this.data=[],this.required_field={}},async generate(t){try{this.loading=!0;const a=await this.axios.get("module/generate/"+this.related_module);this.form[t]=a.data,this.loading=!1}catch{}},set_form(t){this.required_field=[],this.form=Object.assign(this.form,{module:this.module,id:"",related_id:"",created_at:"",updated_at:"",created_by:"",updated_by:""}),t.map(a=>{a.fields.map(e=>{const s={};if(s[e.name]=e.default_value==null?"":e.default_value,this.form=Object.assign(this.form,s),e.type=="dropdown"?n.get_dropdown(e.name):e.type=="generate"&&(this.id==""||this.id===void 0)&&this.generate(e.name),e.required==1){const r={};r[e.name]=e.label,this.get_required_field(r)}})})},get_required_field(t){this.required_field=Object.assign(this.required_field,t)},async get_edit_form(t,a){try{const e=await this.axios.get("module/edit/form/"+this.related_module),s=e.data.data;this.id=t,this.set_form(s.blocks),this.data=e.data.data,a!=""&&this.get(t,a)}catch{}},async get(t,a){try{this.loading=!0;const s=(await this.axios.get("module/"+a,{params:{module:this.related_module}})).data.data;Object.keys(this.form).map(i=>{i!="module"&&i!="id"&&(this.form[i]=s[i])}),this.form.id=parseInt(t),this.form.related_id=a,this.loading=!1}catch{}},async save(){try{this.loading=!0,this.form.related_module=this.related_module,this.form.module=this.module;const t=await this.axios.post("save_relation",this.form);this.loading=!1,this.get_column(this.form.id,this.form.module,this.form.related_module),this.modal=!1}catch{}},async delete(t,a,e,s,r){try{this.loading=!0,(await this.axios.get("related/delete/"+t+"/"+a+"/"+e+"/"+s)).data.data==1&&this.list_data.splice(r,1),this.loading=!1}catch{}}},persist:!0});export{c as u};
