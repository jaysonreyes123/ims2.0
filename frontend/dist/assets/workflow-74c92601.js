import{u as n,U as d}from"./index-703ff788.js";import{u as h}from"./dropdown-c7aa31e0.js";import{u as f}from"./report-4c7cd817.js";const c=h(),p=n();f();const _=d("workflow",{state:()=>({loading:!1,loading2:!1,modal:!1,fields_list:[],fields_list_action:[],required_field:[],rows:[],page:{current:1,total:1,perpage:15},form:{id:"",name:"",module:"",description:"",status:1,trigger:1,recurrence:1,condition:[],action:{title:"",type:"",status:"",actions:[]}}}),actions:{async list(){try{this.loading=!0;const t=await this.axios.get("workflows?page="+this.page.current);this.rows=t.data.data,this.page.total=t.data.meta.total,this.loading=!1}catch{}},async get(){try{this.loading=!0;const s=(await this.axios.get("workflows/"+this.form.id+"/edit")).data.data,a=p.module.find(r=>r.id==s.module);this.form.id=s.id,this.form.module=a.name,this.form.name=s.name,this.form.description=s.description,this.form.status=s.status,this.form.trigger=s.trigger,this.form.recurrence=s.recurrence,this.get_fields(s.workflow_conditions),this.loading=!1}catch{}},async get_fields(t=[]){try{this.loading=!0,this.fields_list=[],this.form.selected_column=[];const a=(await this.axios.post("reports/get_fields",{module:this.form.module})).data.data;Object.keys(a).map(o=>{this.fields_list.push({label:o,header:!0}),a[o].map(i=>{const e=i.table+"."+i.name;this.fields_list.push({label:i.label,value:e,type:i.type,header:!1})})}),t.length>0&&t.map(o=>{this.form.condition.push({type:o.type,field:o.field,value:o.value,operator:o.operator})}),this.loading=!1}catch{}},async get_fields_action(t){try{this.loading=!0,this.fields_list_action=[],this.required_field=[];const a=(await this.axios.post("reports/get_fields",{module:t})).data.data,r=Object.keys(a),o=[];r.map(i=>{this.fields_list_action.push({label:i,header:!0}),a[i].map(e=>{const l=e.table+"."+e.name;this.fields_list_action.push({label:e.label,value:l,type:e.type,name:e.name,header:!1}),e.column&&(e.type=="dropdown"&&c.get_dropdown(e.name),this.required_field.push(l),this.form.action.actions.push({type:e.type,field:l,name:e.name,value:""}))})}),this.loading=!1}catch{}},async save(){try{if(this.loading=!0,this.form.id==""){const t=await this.axios.post("workflows",this.form)}else{const t=await this.axios.put("workflows/"+this.form.id,this.form)}this.loading=!1,this.router.push({name:"workflow"})}catch{}}},persist:!0});export{_ as u};
